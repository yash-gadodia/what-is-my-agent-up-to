<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>What Is My Agent Up To? | Lorong AI Lanes</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <main class="layout">
      <aside class="panel panel-left" aria-label="Runs and connection">
        <h1>What Is My Agent Up To?</h1>
        <p id="wsStatus" class="chip">WS: connecting</p>
        <div class="control-group">
          <label class="field">
            Repo path
            <input id="repoPathInput" type="text" placeholder="/abs/path/to/repo" spellcheck="false" />
          </label>
          <label class="toggle">
            <input id="useGitDiffToggle" type="checkbox" />
            Use git diff
          </label>
          <div class="row">
            <button id="setRepoBtn" type="button">Set Repo</button>
            <button id="reconnectBtn" type="button">Reconnect WS</button>
          </div>
          <p id="helperStatus" class="muted">Helper: optional</p>
        </div>

        <div class="control-group">
          <div class="row">
            <button id="newRunBtn" type="button">New Run</button>
            <button id="simPackBtn" type="button">Simulator Pack</button>
          </div>
          <div class="row">
            <button id="simScoldedBtn" type="button">Sim scolded</button>
            <button id="simLongtaskBtn" type="button">Sim longtask</button>
            <button id="simAsleepBtn" type="button">Sim asleep</button>
          </div>
        </div>

        <section>
          <h2>Lorong lanes (runs)</h2>
          <ul id="runList" class="run-list"></ul>
        </section>
      </aside>

      <section class="panel panel-center" aria-label="City and timeline">
        <section class="caption-bar" aria-live="polite">
          <div class="caption-main">
            <p id="captionMode" class="caption-pill">Mode: Live</p>
            <p id="captionLane" class="caption-pill">Lorong: Waiting</p>
            <p id="captionArea" class="caption-pill">Area: Waiting</p>
            <p id="captionState" class="caption-pill">State: Waiting</p>
          </div>
          <p id="captionStep" class="caption-step">Current step: Waiting for first event.</p>
          <p id="captionFile" class="caption-file">Current file: none</p>
        </section>

        <div class="canvas-wrap">
          <canvas id="cityCanvas" width="1280" height="720"></canvas>
          <p id="stuckBanner" class="stuck-banner" hidden>Stuck signal</p>
          <p id="runBadge" class="run-badge">run: none</p>
        </div>

        <section class="story-panel" aria-live="polite">
          <p id="storyState" class="story-state">Agent state: waiting</p>
          <div class="story-top-row">
            <h2 id="storyTitle">What is happening now</h2>
            <button id="focusModeBtn" type="button">Focus View: On</button>
          </div>
          <p id="storyBody">Waiting for events.</p>
          <p id="storyFacts" class="story-facts">No recent activity yet.</p>
          <ul id="storyReasons" class="story-reasons"></ul>
          <p id="storyNext" class="story-next">Next: waiting for first event.</p>
          <div class="legend-box">
            <p class="story-legend">Legend</p>
            <ul class="legend-list">
              <li><strong>Backend</strong> = core app and backend work</li>
              <li><strong>Frontend</strong> = frontend and UI work</li>
              <li><strong>Infra</strong> = infra, config, deploy work</li>
              <li><strong>Tests</strong> = tests and QA work</li>
              <li><strong>Merlion HQ</strong> = the main agent</li>
              <li><strong>Lorong lane</strong> = one run or thread street for an agent flow</li>
              <li>Cars = tools running, desk upgrades = file changes, red = errors, fireworks = success</li>
            </ul>
          </div>
        </section>

        <section class="replay-bar" aria-label="Replay controls">
          <div class="row replay-row">
            <button id="playPauseBtn" type="button">Play</button>
            <button id="liveViewBtn" type="button">Live View</button>
            <label class="field-inline">
              Speed
              <select id="replaySpeed">
                <option value="1">1x</option>
                <option value="2">2x</option>
                <option value="5">5x</option>
              </select>
            </label>
            <button id="exportRunBtn" type="button">Export JSONL</button>
            <label class="import-label" for="importRunInput">Import JSONL</label>
            <input id="importRunInput" type="file" accept=".jsonl,.txt,.json" />
          </div>
          <input id="replaySlider" type="range" min="0" max="0" value="0" />
          <p id="replayInfo" class="muted">Replay: ready</p>
        </section>

        <section class="timeline-panel">
          <h2>Timeline (last 200)</h2>
          <ul id="timelineList"></ul>
        </section>
      </section>

      <aside class="panel panel-right" aria-label="Run insights">
        <h2>Run scorecard</h2>
        <dl id="scorecard" class="scorecard">
          <div><dt>Duration</dt><dd id="metricDuration">0s</dd></div>
          <div><dt>Tool activity</dt><dd id="metricToolCount">0</dd></div>
          <div><dt>File changed</dt><dd id="metricFileCount">0</dd></div>
          <div><dt>Error</dt><dd id="metricErrorCount">0</dd></div>
          <div><dt>Success</dt><dd id="metricSuccessCount">0</dd></div>
          <div><dt>Stuck score</dt><dd id="metricStuck">0.00</dd></div>
        </dl>

        <section class="insight-block">
          <h3>Suggested intervention</h3>
          <p id="interventionText" class="muted">No intervention needed yet.</p>
        </section>

        <section class="insight-block">
          <h3>Inspector</h3>
          <p id="inspectorSummary" class="muted">Select a timeline item to inspect.</p>
          <pre id="inspectorRaw"></pre>
        </section>
      </aside>
    </main>

    <script type="module" src="/app.js"></script>
  </body>
</html>
